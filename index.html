<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>멀티뷰 사이트 생성기 (이미지 확대/축소 + 드래그 이동)</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0; padding: 10px;
      box-sizing: border-box;
      min-height: 100vh;
      background: #fff;
      display: flex; flex-direction: column;
    }
    h1 {
      text-align: center; margin-bottom: 15px;
    }
    .controls {
      max-width: 900px; margin: 0 auto 15px;
      display: flex; flex-wrap: wrap;
      gap: 10px; align-items: center; justify-content: center;
      transition: opacity 0.3s ease;
    }
    label {
      white-space: nowrap; font-weight: bold;
    }
    input[type=number] {
      width: 60px; padding: 5px; font-size: 1rem; text-align: center;
    }
    select, button {
      padding: 6px 12px; font-size: 1rem; cursor: pointer;
    }
    #urlInputs {
      max-width: 900px; margin: 0 auto 20px;
      display: flex; flex-wrap: wrap; gap: 8px; justify-content: center;
      transition: opacity 0.3s ease;
    }
    #urlInputs input[type=text] {
      flex: 1 1 300px; min-width: 220px; padding: 7px 10px; font-size: 1rem;
    }
    #iframeContainer {
      flex-grow: 1;
      max-width: 100vw; max-height: calc(100vh - 220px);
      margin: 0 auto; background: #fff;
      display: flex; flex-wrap: wrap; gap: 0; overflow: hidden;
      transition: all 0.3s ease;
    }
    .iframe-wrapper {
      position: relative;
      flex-grow: 1; flex-shrink: 1; flex-basis: 0;
      overflow: hidden; background: #fff;
      display: flex; justify-content: center; align-items: center;
      touch-action: none; /* 터치 드래그 인식용 */
    }

    /* iframe 스타일 */
    .iframe-wrapper iframe {
      border: none;
      width: 100%;
      height: 100%;
    }

    /* 이미지 스타일 */
    .iframe-wrapper img {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain; /* 크기에 맞춰 비율 유지 */
      user-select: none;
      cursor: grab;
      transition: transform 0.1s ease;
      /* transform은 JS에서 관리 */
    }
    .iframe-wrapper img:active {
      cursor: grabbing;
    }

    /* 확대/축소 버튼 */
    .zoom-controls {
      position: absolute;
      top: 5px; right: 5px;
      display: flex; gap: 4px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 4px; padding: 2px;
      user-select: none; z-index: 10;
    }
    .zoom-controls button {
      background: rgba(255, 255, 255, 0.8);
      border: none; border-radius: 3px;
      width: 24px; height: 24px;
      font-weight: bold; cursor: pointer;
      line-height: 1; padding: 0;
      display: flex; justify-content: center; align-items: center;
      font-size: 18px; color: #333;
      transition: background 0.2s ease;
    }
    .zoom-controls button:hover {
      background: rgba(255, 255, 255, 1);
    }

    /* 레이아웃별 스타일 */
    .layout-vertical {
      flex-direction: column; align-items: stretch;
    }
    .layout-vertical .iframe-wrapper {
      width: 100%;
      height: calc((100% - (var(--count) - 1) * 0px) / var(--count));
      flex-basis: auto; flex-grow: 0; flex-shrink: 0;
    }
    .layout-horizontal {
      flex-direction: row; align-items: stretch;
    }
    .layout-horizontal .iframe-wrapper {
      height: 100%;
      width: calc((100% - (var(--count) - 1) * 0px) / var(--count));
      flex-basis: auto; flex-grow: 0; flex-shrink: 0;
    }
    .layout-grid {
      display: grid; gap: 0; background: #fff;
    }
    .layout-grid .iframe-wrapper {
      width: 100% !important;
      height: 100% !important;
      flex: none !important;
      background: #fff;
    }

    /* 반응형 모바일 */
    @media (max-width: 600px) {
      #urlInputs input[type=text] {
        flex: 1 1 100%; min-width: auto;
      }
      .controls {
        flex-direction: column; gap: 15px;
      }
      #iframeContainer.layout-grid {
        grid-template-columns: 1fr !important;
        grid-template-rows: repeat(auto-fit, minmax(120px, 1fr)) !important;
      }
      #iframeContainer.layout-horizontal .iframe-wrapper {
        width: 100% !important; height: 200px !important;
        flex-basis: auto !important; flex-grow: 0 !important; flex-shrink: 0 !important;
      }
      #iframeContainer.layout-vertical .iframe-wrapper {
        height: 200px !important;
      }
    }
    #closeBtn {
      position: fixed; bottom: 10px; right: 10px;
      width: 28px; height: 28px;
      background: rgba(0,0,0,0.6);
      color: #fff; font-weight: bold; font-size: 20px;
      line-height: 28px; text-align: center;
      border-radius: 50%; cursor: pointer; user-select: none;
      z-index: 9999; transition: background 0.3s ease;
      display: none;
    }
    #closeBtn:hover {
      background: rgba(0,0,0,0.9);
    }
  </style>
</head>
<body>
  <h1 id="pageTitle">멀티뷰 사이트 생성기 (이미지 확대/축소 + 드래그 이동)</h1>

  <div class="controls" id="controlsSection">
    <label for="countInput">몇 분할?</label>
    <input type="number" id="countInput" min="1" max="16" value="4" />

    <label for="layoutSelect">레이아웃</label>
    <select id="layoutSelect">
      <option value="vertical">가로 정렬</option>
      <option value="horizontal">세로 정렬</option>
      <option value="grid" selected>바둑판(그리드)</option>
    </select>

    <button id="generateBtn">주소 입력창 만들기</button>
  </div>

  <form id="urlInputs"></form>

  <button id="openBtn" style="display:none; max-width:900px; margin:0 auto 15px; padding: 10px 20px; font-size:1.2rem; cursor:pointer;">
    OPEN (멀티뷰 보기)
  </button>

  <div id="iframeContainer" style="max-width:900px; margin-bottom: 30px;"></div>

  <div id="closeBtn">×</div>

<script>
  const countInput = document.getElementById("countInput");
  const layoutSelect = document.getElementById("layoutSelect");
  const generateBtn = document.getElementById("generateBtn");
  const urlInputsForm = document.getElementById("urlInputs");
  const openBtn = document.getElementById("openBtn");
  const iframeContainer = document.getElementById("iframeContainer");
  const controlsSection = document.getElementById("controlsSection");
  const closeBtn = document.getElementById("closeBtn");
  const pageTitle = document.getElementById("pageTitle");

  let currentUrls = [];
  let currentLayout = "grid";

  const zoomLevels = [];
  // 이미지별 위치 이동 좌표 저장 (x, y)
  const translatePositions = [];

  function isImageUrl(url) {
    return /\.(jpg|jpeg|png|gif|webp|bmp|svg)$/i.test(url);
  }

  generateBtn.addEventListener("click", () => {
    let count = parseInt(countInput.value);
    if (isNaN(count) || count < 1 || count > 16) {
      alert("1 ~ 16 사이의 숫자를 입력하세요.");
      return;
    }
    urlInputsForm.innerHTML = "";
    zoomLevels.length = 0;
    translatePositions.length = 0;
    for (let i = 0; i < count; i++) {
      const input = document.createElement("input");
      input.type = "text";
      input.placeholder = `사이트 또는 이미지 URL #${i + 1}`;
      input.name = `url${i}`;
      input.autocomplete = "off";
      urlInputsForm.appendChild(input);
      zoomLevels.push(1);
      translatePositions.push({ x: 0, y: 0 });
    }
    openBtn.style.display = "inline-block";
  });

  function updateTransform(index) {
    const wrapper = iframeContainer.children[index];
    if (!wrapper) return;
    const img = wrapper.querySelector("img");
    const iframe = wrapper.querySelector("iframe");

    if (img) {
      const pos = translatePositions[index];
      const scale = zoomLevels[index];
      img.style.transform = `translate(${pos.x}px, ${pos.y}px) scale(${scale})`;
    } else if (iframe) {
      // iframe 확대/축소 (위치는 고정)
      iframe.style.transform = `scale(${zoomLevels[index]})`;
    }
  }

  function updateZoom(index, delta) {
    zoomLevels[index] += delta;
    if (zoomLevels[index] < 0.3) zoomLevels[index] = 0.3;
    if (zoomLevels[index] > 5) zoomLevels[index] = 5;
    updateTransform(index);
  }

  openBtn.addEventListener("click", () => {
    const inputs = urlInputsForm.querySelectorAll("input[type=text]");
    let urls = [];
    for (let input of inputs) {
      if (input.value.trim() !== "") {
        urls.push(input.value.trim());
      }
    }
    if (urls.length === 0) {
      alert("하나 이상의 URL을 입력하세요.");
      return;
    }

    currentUrls = urls;
    currentLayout = layoutSelect.value;

    controlsSection.style.display = "none";
    urlInputsForm.style.display = "none";
    openBtn.style.display = "none";
    pageTitle.style.display = "none";

    iframeContainer.style.maxWidth = "100vw";
    iframeContainer.style.margin = "0";
    iframeContainer.style.maxHeight = "100vh";
    iframeContainer.style.height = "100vh";

    iframeContainer.style.setProperty("--count", urls.length);
    iframeContainer.className = "";

    if (currentLayout === "vertical") {
      iframeContainer.classList.add("layout-vertical");
      iframeContainer.style.removeProperty("grid-template-columns");
      iframeContainer.style.removeProperty("grid-template-rows");
      iframeContainer.style.display = "flex";
    } else if (currentLayout === "horizontal") {
      iframeContainer.classList.add("layout-horizontal");
      iframeContainer.style.removeProperty("grid-template-columns");
      iframeContainer.style.removeProperty("grid-template-rows");
      iframeContainer.style.display = "flex";
    } else {
      iframeContainer.classList.add("layout-grid");
      const count = currentUrls.length;
      const cols = Math.ceil(Math.sqrt(count));
      const rows = Math.ceil(count / cols);
      iframeContainer.style.display = "grid";
      iframeContainer.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
      iframeContainer.style.gridTemplateRows = `repeat(${rows}, 1fr)`;
      iframeContainer.style.gap = "0";
    }

    iframeContainer.innerHTML = "";
    zoomLevels.length = urls.length;
    translatePositions.length = urls.length;

    for (let i = 0; i < urls.length; i++) {
      zoomLevels[i] = 1;
      translatePositions[i] = { x: 0, y: 0 };

      const url = urls[i];
      const wrapper = document.createElement("div");
      wrapper.className = "iframe-wrapper";

      if (isImageUrl(url)) {
        const img = document.createElement("img");
        img.src = url;
        img.alt = `Image #${i + 1}`;
        img.draggable = false;
        wrapper.appendChild(img);

        // 드래그 변수 초기화
        let isDragging = false;
        let startX, startY;

        img.addEventListener("mousedown", (e) => {
          e.preventDefault();
          isDragging = true;
          startX = e.clientX;
          startY = e.clientY;
          img.style.cursor = "grabbing";
        });
        window.addEventListener("mouseup", () => {
          if (isDragging) {
            isDragging = false;
            img.style.cursor = "grab";
          }
        });
        window.addEventListener("mousemove", (e) => {
          if (!isDragging) return;
          e.preventDefault();
          const dx = e.clientX - startX;
          const dy = e.clientY - startY;
          startX = e.clientX;
          startY = e.clientY;
          translatePositions[i].x += dx;
          translatePositions[i].y += dy;
          updateTransform(i);
        });

        // 모바일 터치 지원
        img.addEventListener("touchstart", (e) => {
          if (e.touches.length === 1) {
            e.preventDefault();
            isDragging = true;
            startX = e.touches[0].clientX;
            startY = e.touches[0].clientY;
            img.style.cursor = "grabbing";
          }
        }, { passive: false });
        window.addEventListener("touchend", () => {
          if (isDragging) {
            isDragging = false;
            img.style.cursor = "grab";
          }
        });
        window.addEventListener("touchcancel", () => {
          if (isDragging) {
            isDragging = false;
            img.style.cursor = "grab";
          }
        });
        window.addEventListener("touchmove", (e) => {
          if (!isDragging) return;
          if (e.touches.length !== 1) return;
          e.preventDefault();
          const dx = e.touches[0].clientX - startX;
          const dy = e.touches[0].clientY - startY;
          startX = e.touches[0].clientX;
          startY = e.touches[0].clientY;
          translatePositions[i].x += dx;
          translatePositions[i].y += dy;
          updateTransform(i);
        }, { passive: false });

      } else {
        // 유튜브 embed URL 간단 변환 (선택사항)
        let fixedUrl = url;
        if (/youtu\.?be/.test(url)) {
          const ytIdMatch = url.match(/(?:youtu\.be\/|v=)([a-zA-Z0-9_-]{11})/);
          if (ytIdMatch) {
            fixedUrl = `https://www.youtube.com/embed/${ytIdMatch[1]}`;
          }
        }
        const iframe = document.createElement("iframe");
        iframe.src = fixedUrl;
        iframe.setAttribute("allowfullscreen", "");
        iframe.setAttribute("loading", "lazy");
        wrapper.appendChild(iframe);
      }

      const zoomControls = document.createElement("div");
      zoomControls.className = "zoom-controls";

      const btnZoomIn = document.createElement("button");
      btnZoomIn.textContent = "+";
      btnZoomIn.title = "확대";
      btnZoomIn.addEventListener("click", e => {
        e.stopPropagation();
        e.preventDefault();
        updateZoom(i, 0.1);
      });

      const btnZoomOut = document.createElement("button");
      btnZoomOut.textContent = "−";
      btnZoomOut.title = "축소";
      btnZoomOut.addEventListener("click", e => {
        e.stopPropagation();
        e.preventDefault();
        updateZoom(i, -0.1);
      });

      zoomControls.appendChild(btnZoomIn);
      zoomControls.appendChild(btnZoomOut);
      wrapper.appendChild(zoomControls);

      iframeContainer.appendChild(wrapper);
    }

    closeBtn.style.display = "flex";
    window.scrollTo({ top: 0, behavior: "smooth" });
  });

  closeBtn.addEventListener("click", () => {
    controlsSection.style.display = "flex";
    urlInputsForm.style.display = "flex";
    openBtn.style.display = "inline-block";
    pageTitle.style.display = "block";

    iframeContainer.style.maxWidth = "900px";
    iframeContainer.style.margin = "0 auto 30px";
    iframeContainer.style.maxHeight = "calc(100vh - 220px)";
    iframeContainer.style.height = "auto";

    iframeContainer.innerHTML = "";
    closeBtn.style.display = "none";
  });
</script>
